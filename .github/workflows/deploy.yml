name: Deploy Face Detection System

on:
  push:
    branches: [ main ]

jobs:
  build-and-deploy:
    runs-on: ubuntu-latest
    
    steps:
    - uses: actions/checkout@v3
    
    - name: Build Backend Docker Image
      run: |
        docker build -t face-detection-backend:${{ github.sha }} ./backend
        docker tag face-detection-backend:${{ github.sha }} face-detection-backend:latest
    
    - name: Build Frontend Docker Image
      run: |
        docker build -t face-detection-frontend:${{ github.sha }} ./frontend
        docker tag face-detection-frontend:${{ github.sha }} face-detection-frontend:latest
    
    - name: Push to Registry
      run: |
        echo ${{ secrets.DOCKER_PASSWORD }} | docker login -u ${{ secrets.DOCKER_USERNAME }} --password-stdin
        docker push face-detection-backend:latest
        docker push face-detection-frontend:latest
    
    - name: Deploy to Production
      run: |
        # Add your deployment commands here
        # kubectl apply -f k8s/
        # or
        # docker-compose -f docker-compose.prod.yml up -d